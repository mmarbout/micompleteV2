import pytest
import os
from collections import defaultdict

from micomplete import micomplete, calcCompleteness, parseSeqStats, linkageAnalysis

PATH = os.path.abspath(os.path.dirname(__file__))

def test_linkage():
    """ """
    locations = defaultdict(list,
                            {'1': [[91, 456]],
                             '2': [[511, 633]],
                             '3': [[697, 828]],
                             '4': [[868, 1077]],
                             '5': [[1200, 1610]],
                             '6': [[1612, 1687]],
                             '7': [[1721, 3022]],
                             '8': [[3268, 3805]],
                             '9': [[4032, 4206]],
                             '10': [[4310, 4692]],
                             '11': [[5237, 5332]],
                             '12': [[6174, 6414]],
                             '13': [[6656, 6936]],
                             '14': [[7170, 7381]],
                             '15': [[8311, 8535]],
                             '16': [[9474, 9844]]})
    neighbour_dist = defaultdict(list,
                                {'1': [56, 248],
                                 '2': [65, 56],
                                 '3': [41, 65],
                                 '4': [124, 41],
                                 '5': [3, 124],
                                 '6': [35, 3],
                                 '7': [247, 35],
                                 '8': [228, 247],
                                 '9': [105, 228],
                                 '10': [546, 105],
                                 '11': [843, 546],
                                 '12': [243, 843],
                                 '13': [235, 243],
                                 '14': [931, 235],
                                 '15': [940, 931],
                                 '16': [248, 940]})
    linkage_scores = {'1': [0.031083844580777096],
                      '2': [0.012372188139059305],
                      '3': [0.010838445807770962],
                      '4': [0.01687116564417178],
                      '5': [0.012985685071574642],
                      '6': [0.003885480572597137],
                      '7': [0.02883435582822086],
                      '8': [0.04856850715746421],
                      '9': [0.034049079754601225],
                      '10': [0.06656441717791411],
                      '11': [0.14202453987730063],
                      '12': [0.11104294478527607],
                      '13': [0.04887525562372188],
                      '14': [0.11922290388548057],
                      '15': [0.19130879345603272],
                      '16': [0.12147239263803682]}
    linkage_in = PATH + '/test_data/linkage_in.list'
    linkage_hmms = defaultdict(list,
                               {'1': [['PT_1']],
                                '2': [['PT_2']],
                                '3': [['PT_3']],
                                '4': [['PT_4']],
                                '5': [['PT_5']],
                                '6': [['PT_6']],
                                '7': [['PT_7']],
                                '8': [['PT_8']],
                                '9': [['PT_9']],
                                '10': [['PT_10']],
                                '11': [['PT_11']],
                                '12': [['PT_12']],
                                '13': [['PT_13']],
                                '14': [['PT_14']],
                                '15': [['PT_15']],
                                '16': [['PT_16']]})
    seqstats = ["", 10000, [1], "", ""]
    l = linkageAnalysis(linkage_in, "test", "na", linkage_in, seqstats, linkage_hmms)
    assert l.get_locations() == locations
    assert l.find_neighbour_distance() == neighbour_dist
    assert l.calculate_linkage_scores() == linkage_scores
